

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



// User Model
model User {
  id              Int      @id @default(autoincrement())
  username        String
  email           String   @unique
  password        String?  
  phone           String?  
  googleId        String?  @unique // Google OAuth ID
  avatar          String?  
  isEmailVerified Boolean  @default(false)
  authProvider    String   @default("local") // "local", "google"
  resetPasswordOTP String? 
  resetPasswordOTPExpires DateTime? 
  resetPasswordToken String? 
  resetPasswordTokenExpires DateTime? 
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  payments Payment[]
  wishlists       Wishlist[]
  enrollments Enrollment[]
  instructedCourses Course[] 
  paymentMethods PaymentMethod[]
  @@map("users")
}





enum CourseLocation {
  ELEARNING
  ONSITE
  ONLINE
  HYBRID
}

// Course Model
model Course {
  id              Int      @id @default(autoincrement())
  image           String
  name            String
  duration        String
  location        CourseLocation[]  
  startDate       DateTime
  endDate         DateTime
  fees            String
  language        String
  overview        String?
  objectives      String[]
  outcomes        String?
  agenda          Json?
  examination     String?
  accreditation   String   
  paymentMethods  String[]
  instructor      User?    @relation(fields: [instructorId], references: [id])
  instructorId    Int?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  payments Payment[]
  enrollments Enrollment[]
  wishlists       Wishlist[]
  @@map("courses")
}



// Enrollment Mode Enum
enum EnrollmentMode {
  ELEARNING
  ONSITE
  ONLINE
  HYBRID
}


// Enrollment Model
model Enrollment {
  id           Int      @id @default(autoincrement())
  userId       Int
  courseId     Int
  enrolledAt   DateTime @default(now())
  status       String   @default("active") // "active", "completed", "dropped", "suspended"
  completedAt  DateTime?
  EnrollmentMode  EnrollmentMode 
  // Relations
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  // Ensure a user can only enroll once per course
  @@unique([userId, courseId])
  @@map("enrollments")
}


// Payment Model
model Payment {
  id        Int      @id @default(autoincrement())
  userId    Int
  courseId  Int
  amount    Float
  status    String   @default("pending") // "pending" or "success"
  createdAt DateTime @default(now())

  // Relations
  user   User   @relation(fields: [userId], references: [id])
  course Course @relation(fields: [courseId], references: [id])

  @@map("payments")
}

// PaymentMethod Model
model PaymentMethod {
  id             Int      @id @default(autoincrement())
  userId         Int
  method         String   @default("visa") 
  cardNumber     String?
  cvv            String?
  expiryDate     String?  // MM/YY
  cardHolderName String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@map("payment_methods")
}



model Wishlist {
  id        Int      @id @default(autoincrement())
  userId    Int
  courseId  Int
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId]) 
}
